# Пользователь-Подписка (User-Subscription) #
Сервис для управления пользователями и их подписками. Проект написан на Java с использованием фреймворка Spring Boot.
## Описание проекта ##
Данный проект реализует простое RESTful API для управления пользователями и их подписками. Основные функциональные возможности включают:
* Создание пользователя.
* Получение пользователя по ID.
* Удаление пользователя по ID.
* Изменение пользователя.
* Добавления пользователю подписки.
* Удаление подписки у пользователя
* Показ топ 3 подписок

<br>  Сервис построен с учётом принципов отказоустойчивости и производительности. Код сопровожден документацией и комментариями для лучшего понимания архитектуры и функциональных деталей.

## Требования ##

* Java 17+
* Apache Maven
* PostgreSQL (рекомендуемая версия 16+)
* Docker (для быстрого старта)

## Установка и запуск ##

Для установки и запуска сервиса выполните следующие шаги:

### 1. Скачать исходный код: ###
```
 git clone https://github.com/AntonBuzynnikov/user-subscription-service
 cd user-subscription-service
```

### 2. Выполнить команду для сборки проекта: ###
```
 mvn clean package
```

### 3. Собрать образ Docker из Dockerfile ###

```
docker build -t {имя_образа} .
```

### 4. Запустить Docker-compose: ###
Предварительно измените параметр **services.app.image** на **имя_образа**
```
docker compose up
```

Проект имеет базовые настройки для запуска, поэтому дополнительной настройки не требуется

Если необходимо, можете изменить переменные окружение Spring Boot, такие как:
```
 SPRING_DATASOURCE_URL
 SPRING_DATASOURCE_USERNAME
 SPRING_DATASOURCE_PASSWORD
```

Со списком всех параметров можно ознакомиться в документации к Spring.

## Тестирование ##

## ВАЖНО! Добавьте подписки либо с помощью миграции, либо войдя в контейнер PostgreSQL, либо с помощью клиента для базы данных ##

Тестируйте сервис с помощью curl или Postman:
### 1. Создать пользователя ###
```
    {
        "name":"имя_пользователя"
    }
    
    POST http://{HOST}:{PORT}/api/v1/users
```

Параметр **name** имеет тип String.
Конечная точная возвращает ответ в виде JSON
```
Status: 201

{
   "id": 1
   "balance": {имя_пользователя}
}
```

### 2. Получение пользователя ###
```
GET http://{HOST}:{PORT}/api/v1/users/{id}
```
Конечная точка возвращает ответ:
```
Status: 200

{
   "id": {id}
   "name": {имя_пользователя}
}
```
### 3. Изменение пользователя ###

```
    {
        "name":"имя_пользователя"
    }
    
    PUT http://{HOST}:{PORT}/api/v1/users/{id}
```
Конечная точка возвращает ответ:
```
Status: 204
```
### 4. Удаление пользователя ###

```
    DELETE http://{HOST}:{PORT}/api/v1/users/{id}
```
Конечная точка возвращает ответ:
```
Status: 204
```
### 5. Добавление подписки пользователю ###

```
    {
        "id":{id_подписки}
    }
    
    POST http://{HOST}:{PORT}/api/v1/users/{id}/subscruptions
```
Конечная точка возвращает ответ:
```
Status: 204
```
### 6. Удаление подписки у пользователя ###

```
    DELETE http://{HOST}:{PORT}/api/v1/users/{id}/subscriptions/{subscriptionId}
```
Конечная точка возвращает ответ:
```
Status: 204
```
### 7. Получение топ-3 подписок ###

Исходя из количества подписанных пользователей

```
    GET http://{HOST}:{PORT}/api/v1/subscriptions/top
```
Конечная точка возвращает ответ:

```
Status: 200
[
    {
        "id": {id1}
        "name": {имя_подписки1}
    },
    {
        "id": {id2}
        "name": {имя_подписки2}
    },
    {
        "id": {id2}
        "name": {имя_подписки2}
    }
]
```
### 8. Получение подписок пользователя ###

Исходя из количества подписанных пользователей

```
    GET http://{HOST}:{PORT}/api/v1/user/{id}/subscriptions
```
Конечная точка возвращает ответ:

```
Status: 200
[
    {
        "id": {id1}
        "name": {имя_подписки1}
    },
    {
        "id": {id2}
        "name": {имя_подписки2}
    },
    {
        "id": {id2}
        "name": {имя_подписки2}
    }
]
```

### Возможные ошибки: ###
1. **Пользователь не найден:** возвращает **Status 404** и описание ошибки
2. **Подписка не найдена:** возвращает **Status 404** и описание ошибки
3. **Ошибки валидации:** возникает из-за неправильных данных у параметров **id** и **name**. Возвращает **Status 400** и описание ошибки
4. **Дублирование данных:** возвращает **Status 409** и описание ошибки. Возникает при попытке повторно добавить пользователю ту же самую подписку

## Поддерживаемые технологии ##

* Spring Boot
* Hibernate/JPA
* Docker/Docker Compose
* PostgreSQL

## Авторство ##
Автор проекта: Антон Бузынников.

*********************

Спасибо за интерес к проекту! Надеюсь, он окажется полезным для ваших целей. Если возникнут вопросы или пожелания, не стесняйтесь оставлять issues в репозитории.
